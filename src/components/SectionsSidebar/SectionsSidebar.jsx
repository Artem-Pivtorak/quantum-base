import React, { useState } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { selectSections, addSection, deleteSection } from '../../redux/sections/sectionsSlice';
import { setSelectedSection, selectSelectedSectionId } from '../../redux/uiSlice';
import css from './SectionsSidebar.module.css';

const SectionsSidebar = ({ isAdmin }) => {
  const dispatch = useDispatch();
  const sections = useSelector(selectSections);
  const selectedId = useSelector(selectSelectedSectionId);
  const [newTitle, setNewTitle] = useState('');
  const [newImage, setNewImage] = useState('');

  const handleAddSection = (e) => {
    e.preventDefault();
    if (!newTitle.trim()) return;
    dispatch(addSection({ title: newTitle, image: newImage }));
    setNewTitle('');
    setNewImage('');
  };

  return (
    <div className={css.sidebar}>
      <h3>–†–æ–∑–¥—ñ–ª–∏</h3>
      <ul className={css.sectionList}>
        <li
          className={`${css.sectionItem} ${selectedId === null ? css.active : ''}`}
          onClick={() => dispatch(setSelectedSection(null))}
        >
          <span className={css.sectionImage}>üè†</span>
          <span className={css.sectionTitle}>–í—Å—ñ —Ñ—Ä–µ–π–º–∏</span>
        </li>
        {sections.map(section => (
          <li
            key={section.id}
            className={`${css.sectionItem} ${selectedId === section.id ? css.active : ''}`}
            onClick={() => dispatch(setSelectedSection(section.id))}
          >
            <span className={css.sectionImage}>{section.image}</span>
            <span className={css.sectionTitle}>{section.title}</span>
            {isAdmin && (
              <button
                className={css.deleteBtn}
                onClick={(e) => {
                  e.stopPropagation();
                  dispatch(deleteSection(section.id));
                  // –Ø–∫—â–æ –≤–∏–¥–∞–ª—è—î–º–æ –≤–∏–±—Ä–∞–Ω–∏–π —Ä–æ–∑–¥—ñ–ª, —Å–∫–∏–¥–∞—î–º–æ –≤–∏–±—ñ—Ä –Ω–∞ –≤—Å—ñ
                  if (selectedId === section.id) {
                    dispatch(setSelectedSection(null));
                  }
                }}
              >
                ‚úï
              </button>
            )}
          </li>
        ))}
      </ul>
      {isAdmin && (
        <form onSubmit={handleAddSection} className={css.addForm}>
          <input
            type="text"
            placeholder="–ù–∞–∑–≤–∞ —Ä–æ–∑–¥—ñ–ª—É"
            value={newTitle}
            onChange={(e) => setNewTitle(e.target.value)}
            required
          />
          <input
            type="text"
            placeholder="–Ü–∫–æ–Ω–∫–∞ (emoji –∞–±–æ URL)"
            value={newImage}
            onChange={(e) => setNewImage(e.target.value)}
          />
          <button type="submit">–î–æ–¥–∞—Ç–∏ —Ä–æ–∑–¥—ñ–ª</button>
        </form>
      )}
    </div>
  );
};

export default SectionsSidebar;